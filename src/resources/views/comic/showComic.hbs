<div class="container" style="margin: 50px 0">
    <div class="row">
        <div class="col-12 col-lg-12 col-xl-8">
            <div class="container-comic">
                <div class="comic-detail">
                    <div class="row">
                        <div class="col-xl-4 col-lg-4 col-md-12 col-12">
                            <div style="display: flex; flex-direction: column; align-item: center; justify-content: center;">
                                <img src="{{comic.urlImage}}" alt="" class="comic-detail-image">
                                <div class="comic-detail-btn">
                                    <a href="/comic/{{comic.slug}}/{{firstChapter comic.detailChapter}}" class="btn btn-modified">Chương đầu</a>
                                    <a href="/comic/{{comic.slug}}/{{comic.detailChapter.0.slugChapter}}" class="btn btn-modified">Chương cuối</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8 col-lg-8 col-md-12 col-12">
                            <div class="comic-detail-name">
                                {{comic.name}}
                            </div>
                            <div class="comic-detail-item">
                                <p>Tác giả:</p>
                                {{comic.author}}
                            </div>
                            <div class="comic-detail-item">
                                <p>Tình trạng:</p> 
                                {{comic.status}}
                            </div>

                            <div class="comic-detail-item">
                                <p>Lượt xem:</p> 
                                <span id="numberOfViews">

                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="comic-detail-content">
                            <div class="comic-detail-content-label">
                                tóm tắt
                            </div>
                            <div class="comic-detail-content-clearly">
                                {{comic.content}}
                            </div>
                        </div>
                        <div class="more-state show-more-content" onclick="showMoreContent()">
                            Xem thêm
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="comic-detail-chapter-label">
                            Danh sách chương ({{comic.detailChapter.length}})
                        </div>
                        <ul class="comic-detail-chapter-list">
                        {{#each comic.detailChapter}}
                            <a href="/comic/{{this.slugComic}}/{{this.slugChapter}}" class="comic-detail-chapter-item">
                                {{this.name}}
                            </a>
                        {{/each}}
                        </ul>
                        <div class="more-state show-more-chapter" onclick="showMoreChapter()">
                            Xem thêm
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-12 col-xl-4">
            <div class="facebook-plugin">
                <div class="facebook-plugin-label">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                        <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
                    </svg>
                    <div>Facebook</div>
                </div>
                <iframe style="background-color: white;" src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2F1647848441994270%2Fphotos%2Fa.1648236181955496%2F3447724662006630&width=340&show_text=true&height=796&appId" width="340" height="796" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
            </div>
        </div>
    </div>
</div>

<script>

    // điều kiện để xem thêm xuất hiện
    function showMoreAppearInContent(){
        var divContentComic = document.querySelector('.comic-detail-content-clearly').offsetHeight
        if (divContentComic == 50)
        {
            document.querySelector('.show-more-content').style.display = 'flex'
        }else {
            document.querySelector('.show-more-content').style.display = 'none'
        }
    }
    function showMoreAppearInChapter(){
        var divContentComic = document.querySelector('.comic-detail-chapter-list').offsetHeight
        if (divContentComic == 500)
        {
            document.querySelector('.show-more-chapter').style.display = 'flex'
        }else {
            document.querySelector('.show-more-chapter').style.display = 'none'
        }
    }
    showMoreAppearInChapter()
    showMoreAppearInContent()

    // xem thêm -> ẩn đi
    function showMoreContent() {
        var eleShowMore = document.querySelector('.show-more-content')
        var statusShowMore = eleShowMore.classList[0]
        if (statusShowMore == 'more-state')
        {
            document.querySelector('.comic-detail-content-clearly').style.maxHeight = 'none'
            eleShowMore.innerHTML = 'Ẩn đi'
            eleShowMore.classList.replace('more-state', 'less-state')
        }else {
            document.querySelector('.comic-detail-content-clearly').style.maxHeight = '50px'
            eleShowMore.innerHTML = 'Xem thêm'
            eleShowMore.classList.replace('less-state', 'more-state')
        }
    }

    // xem thêm -> ẩn đi -> bên chapter
    function showMoreChapter() {
        var eleShowMore = document.querySelector('.show-more-chapter')
        var statusShowMore = eleShowMore.classList[0]
        console.log(statusShowMore)
        if (statusShowMore == 'more-state')
        {
            document.querySelector('.comic-detail-chapter-list').style.maxHeight = 'none'
            eleShowMore.innerHTML = 'Ẩn đi'
            eleShowMore.classList.replace('more-state', 'less-state')
        }else {
            document.querySelector('.comic-detail-chapter-list').style.maxHeight = '500px'
            eleShowMore.innerHTML = 'Xem thêm'
            eleShowMore.classList.replace('less-state', 'more-state')
        }
    }

    // đếm số lượt xem page comic
    function countViewPage() {
        let slug = url => new URL(url).pathname.match(/[^\/]+/g)
        var slugNameComic = `countViewPageComic-${slug(window.location.href)[1]}`

        // lứu ý thằng key= chỉ nhận tối đa 64 ký tự 
        if(slugNameComic.length > 64) {
            slugNameComic = slugNameComic.substring(0, 63)
        }

        fetch(`https://api.countapi.xyz/update/laptop/${slugNameComic}/?amount=1`)
            .then((res) => res.json())
            .then((res) => {
                if(res.value == null) {
                    fetch(`https://api.countapi.xyz/create?namespace=laptop&key=${slugNameComic}&value=0`)
                        .then((res), countViewPage())
                }else {
                    document.getElementById('numberOfViews').innerHTML = `${res.value}`
                }
            })
    }
    countViewPage()
</script>